# ูุธุงู ุงููุตุงุฏูุฉ ูุงูุฃูุงู - ุงูุชุฑููุฉ ุงูุดุงููุฉ

## โ ุงูุชุญุณููุงุช ุงูููุฌุฒุฉ

### 1. **ุชุญุฏูุซ Prisma Schema ุจูุธุงู ูุตุงุฏูุฉ**

#### ุงูุชุญุฏูุซุงุช ูู ูููุฐุฌ User:
```prisma
model User {
  // ... (ุงูุญููู ุงูููุฌูุฏุฉ: id, email, name, phone, role, tenantId, companyId, branchId, transactions, createdAt, updatedAt)
  
  // ุญููู ุงููุตุงุฏูุฉ ุงูุฌุฏูุฏุฉ:
  password          String?      // ูููุฉ ูุฑูุฑ ูุฌุฒุฃุฉ (hashed)
  
  // ุญููู ุงูุฌูุณุฉ/JWT:
  lastLoginAt       DateTime?    // ุขุฎุฑ ุชุณุฌูู ุฏุฎูู
  lastLoginIP       String?      // ุขุฎุฑ IP ุชุณุฌูู ุงูุฏุฎูู
  loginAttempts      Int          @default(0) // ุนุฏุฏ ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู ุงููุงุดูุฉ
  lockedUntil        DateTime?    // ุงูููู ุญุชู (ุจุนุฏ ุนุฏุฏ ูุญุงููุงุช ูุงุดูุฉ)
  
  // ุญููู ุงูุชุญูู ูู ุงูุจุฑูุฏ:
  emailVerified      Boolean      @default(false)
  emailVerifiedAt   DateTime?
  verificationToken   String?      // ุฑูุฒ ุงูุชุญูู ูู ุงูุจุฑูุฏ
  
  // ุญููู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ:
  resetToken          String?      // ุฑูุฒ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
  resetTokenExpiry    DateTime?    // ุชุงุฑูุฎ ุงูุชูุงุก ุฑูุฒ ุงูุฅุนุงุฏุฉ
  
  // ุญููู ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ (ุงุฎุชูุงุฑู ูููุณุชูุจู):
  twoFactorEnabled    Boolean      @default(false)
  twoFactorSecret     String?      // ุณุฑ ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ
  
  // ุงูููุงุฑุณ ุงูุฌุฏูุฏุฉ:
  @@index([email])
  @@index([tenantId, email]) // ูุฑูุฏ ููู ูุณุชุฃุฌุฑ
}
```

#### ุงูููุงุฑุณ ุงููุญุณููุฉ:
```prisma
@@index([email])                    // ูุฑูุฏ ุนุงูููุงู
@@index([tenantId, email])         // ูุฑูุฏ ููู ูุณุชุฃุฌุฑ
@@index([tenantId])               // ููุจุญุซ ุงูุณุฑูุน ุญุณุจ ุงููุณุชุฃุฌุฑ
@@index([companyId])               // ููุจุญุซ ุงูุณุฑูุน ุญุณุจ ุงูุดุฑูุฉ
@@index([branchId])                // ููุจุญุซ ุงูุณุฑูุน ุญุณุจ ุงููุฑุน
```

---

### 2. **ูุธุงู JWT ูููุตุงุฏูุฉ**

#### ููู `/src/lib/auth/jwt.ts`:

```typescript
// ุงูุซูุงุจุช
const JWT_SECRET = new TextEncoder().encode(
  process.env.JWT_SECRET || 'your-super-secret-jwt-key-change-in-production'
)
const JWT_ALGORITHM = 'HS256'

// ุฃููุงุน ุงูุจูุงูุงุช
export interface JWTPayload {
  userId: string
  email: string
  role: string
  tenantId?: string
  companyId?: string
  branchId?: string
  iat?: number
  exp?: number
}

// ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:

1. generateToken(payload):
   - ุชูููุฏ ุฑูุฒ JWT
   - ุตูุงุญูุฉ: 7 ุฃูุงู
   - ูุดูู: userId, email, role, tenantId, companyId, branchId

2. verifyToken(token):
   - ุงูุชุญูู ูู ุตูุงุญูุฉ ุฑูุฒ JWT
   - ุฅุฑุฌุงุน payload ุฃู null
   - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ

3. generateRefreshToken(userId):
   - ุชูููุฏ ุฑูุฒ ุชุญุฏูุซ (refresh token)
   - ุตูุงุญูุฉ: 30 ููู

4. decodeToken(token):
   - ูู ุชุฑููุฒ ุงูุฑูุฒ ุฏูู ุงูุชุญูู (ููุชุตุญูุญ)
   - ุฅุฑุฌุงุน payload ุฃู null

5. setAuthCookie(token, userId):
   - ุญูุธ ุฑูุฒ ุงููุตุงุฏูุฉ ูู cookies
   - ุฅุนุฏุงุฏุงุช: httpOnly, secure, sameSite, maxAge=7d

6. clearAuthCookies():
   - ุญุฐู ุฌููุน cookies ุงููุตุงุฏูุฉ
   - auth_token, user_id
```

#### ุชูููู JWT:
```typescript
{
  secret: ูู .env (JWT_SECRET)
  algorithm: HS256
  access token expiration: 7 ุฃูุงู
  refresh token expiration: 30 ููู
  cookies:
    - httpOnly: true (ููุน XSS)
    - secure: true (ููุท HTTPS ูู production)
    - sameSite: lax (CSRF protection)
    - path: /
    - maxAge: 604800 (7 ุฃูุงู ุจุงูุซูุงูู)
}
```

---

### 3. **ุฅุฏุงุฑุฉ ูููุฉ ุงููุฑูุฑ**

#### ููู `/src/lib/auth/password.ts`:

```typescript
// ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:

1. hashPassword(password):
   - ุงุณุชุฎุฏุงู bcryptjs
   - 10 rounds of hashing
   - ุฅุฑุฌุงุน ูููุฉ ุงููุฑูุฑ ุงููุฌุฒุฃุฉ

2. verifyPassword(password, hashedPassword):
   - ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
   - ุฅุฑุฌุงุน true/false

3. validatePassword(password):
   - ุงูุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ
   - ูุญุต 5 ูุชุทูุจุงุช:
     โข 8 ุฃุญุฑู ุนูู ุงูุฃูู
     โข ุญุฑู ูุจูุฑ ูุงุญุฏ ุนูู ุงูุฃูู
     โข ุญุฑู ุตุบูุฑ ูุงุญุฏ ุนูู ุงูุฃูู
     โข ุฑูู ูุงุญุฏ ุนูู ุงูุฃูู
     โข ุฑูุฒ ุฎุงุต ูุงุญุฏ ุนูู ุงูุฃูู
   - ุญุณุงุจ ุงูููุฉ (weak, fair, good, strong)
   - ุฅุฑุฌุงุน: { isValid, strength, requirements }

4. generateRandomPassword(length = 12):
   - ุชูููุฏ ูููุฉ ูุฑูุฑ ุนุดูุงุฆูุฉ
   - ุฃุญุฑู: a-z, A-Z, 0-9, ุฑููุฒ ุฎุงุตุฉ
   - ุงูุทูู ุงูุงูุชุฑุงุถู: 12 ุญุฑู
```

#### ููุงุนุฏ ูููุฉ ุงููุฑูุฑ:
```
ุงูุญุฏ ุงูุฃุฏูู:
โข 8 ุฃุญุฑู
โข ุญุฑู ูุจูุฑ ูุงุญุฏ
โข ุญุฑู ุตุบูุฑ ูุงุญุฏ
โข ุฑูู ูุงุญุฏ
โข ุฑูุฒ ุฎุงุต ูุงุญุฏ

ุงูุญุฏ ุงูุฃุนูู:
โข 128 ุญุฑู

ุญุณุงุจ ุงูููุฉ:
โข weak: ุฃูู ูู 3 ูุชุทูุจุงุช
โข fair: 3 ูุชุทูุจุงุช
โข good: 4 ูุชุทูุจุงุช
โข strong: 5 ูุชุทูุจุงุช (ุฌููุนูุง)
```

---

### 4. **ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช**

#### ุฃููุงุน ุงูุฃุฏูุงุฑ (UserRole enum):
```prisma
enum UserRole {
  TENANT_OWNER      // ูุงูู ุงููุณุชุฃุฌุฑ - ุฃุนูู ุตูุงุญูุฉ
  COMPANY_MANAGER  // ูุฏูุฑ ุงูุดุฑูุฉ - ุฅุฏุงุฑุฉ ูุงููุฉ ููุดุฑูุฉ
  BRANCH_MANAGER   // ูุฏูุฑ ุงููุฑุน - ุฅุฏุงุฑุฉ ูุงููุฉ ูููุฑุน
  SUPERVISOR       // ูุดุฑู - ุฅุฏุงุฑุฉ ูุญุฏูุฏุฉ
  EMPLOYEE         // ููุธู - ุตูุงุญูุฉ ูุญุฏูุฏุฉ
}
```

#### ุตูุงุญูุงุช ุงูุฃุฏูุงุฑ:

```
1. ูุงูู ุงููุณุชุฃุฌุฑ (TENANT_OWNER):
   โข ุฌููุน ุงูุนูููุงุช
   โข ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
   โข ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
   โข ุงููุตูู ุฅูู ููุญุฉ ุงููุทูุฑ
   โข ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช
   โข ุญุฐู ุงูุจูุงูุงุช

2. ูุฏูุฑ ุงูุดุฑูุฉ (COMPANY_MANAGER):
   โข ุฅุฏุงุฑุฉ ุดุฑูุชู
   โข ุฅุฏุงุฑุฉ ูุฑูุนู
   โข ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ุดุฑูุชู
   โข ุฅุถุงูุฉ/ุญุฐู ุงููุฑูุน
   โข ุฅุฏุงุฑุฉ ูุญุงูุธ ุดุฑูุชู
   โข ุฌููุน ุนูููุงุช ุงููุญุงูุธ ูุงููุนุงููุงุช

3. ูุฏูุฑ ุงููุฑุน (BRANCH_MANAGER):
   โข ุฅุฏุงุฑุฉ ูุฑุนู
   โข ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ูุฑุนู
   โข ุฅุฏุงุฑุฉ ูุญุงูุธ ูุฑุนู
   โข ุนูููุงุช ุงููุญุงูุธ ูุงููุนุงููุงุช ูู ูุฑุนู

4. ูุดุฑู (SUPERVISOR):
   โข ูุดุงูุฏุฉ ุชูุงุฑูุฑ ุงููุฑูุน
   โข ุฅุฏุงุฑุฉ ุงูุนูููุงุช ุงูููููุฉ
   โข ููุงููุฉ ุนูููุงุช ูุจูุฑุฉ
   โข ุฅุฏุงุฑุฉ ุงูุชุตูููุงุช
   โข ุตูุงุญูุฉ ูุญุฏูุฏุฉ ุนูู ุฅุฏุงุฑุฉ ุงููุนุงููุงุช

5. ููุธู (EMPLOYEE):
   โข ุฅูุดุงุก ุงููุนุงููุงุช
   โข ุนุฑุถ ูุญุงูุธู
   โข ุฑุคูุฉ ุชูุงุฑูุฑู ุงูุดุฎุตูุฉ
   โข ุฅุฏุงุฑุฉ ููุงูู
   โข ูุง ููุฌุฏ ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ
```

---

### 5. **ุฅุญุตุงุฆูุงุช ุงููุตุงุฏูุฉ ูุงูุฃูุงู**

#### ุงูููุฒุงุช ุงูุฃูููุฉ:

```
1. ุญูุงูุฉ ุถุฏ ูุฌูุงุช ุงูุชูููุช:
   - ูุญุงูุงุฉ ูุญุต ูููุฉ ุงููุฑูุฑ ุญุชู ูู ูุงูุช ุฎุงุทุฆุฉ
   - ููุน ูุนุฑูุฉ ุงูุจุฑูุฏ/ูููุฉ ุงููุฑูุฑ ููุฌูุฏุฉ

2. ููู ุงูุญุณุงุจ:
   - ููู ุชููุงุฆู ุจุนุฏ 5 ูุญุงููุงุช ูุงุดูุฉ
   - ูุฏุฉ ุงูููู: 15 ุฏูููุฉ
   - ุฅููุงู ุงูุญุณุงุจ ูุคูุชุงู

3. ุชุชุจุน ุชุณุฌูู ุงูุฏุฎูู:
   - ุชุณุฌูู ููุช ุขุฎุฑ ุฏุฎูู
   - ุชุณุฌูู ุนููุงู IP ุงูุฃุฎูุฑ
   - ุนุฏุฏ ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู ุงููุงุดูุฉ

4. ุงูุชุญูู ูู ุงูุจุฑูุฏ:
   - emailVerified: ููุน ุงูุฏุฎูู ุญุชู ุงูุชุญูู
   - emailVerifiedAt: ููุช ุงูุชุญูู
   - verificationToken: ุฑูุฒ ุงูุชุญูู

5. ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ:
   - resetToken: ุฑูุฒ ุฅุนุงุฏุฉ ุงูุชุนููู
   - resetTokenExpiry: ููุช ุงูุชูุงุก ุงูุฑูุฒ
   - ุฅูุดุงุก ุฑูุฒ ุนุดูุงุฆู ุขูู

6. ุฌุฏุงูู ุชุญููู Prisma:
   - @index([email]) ููุจุญุซ ุงูุณุฑูุน
   - @index([tenantId, email]) ููู ูุณุชุฃุฌุฑ
   - @index([companyId]) ููู ุดุฑูุฉ
   - @index([branchId]) ููู ูุฑุน
```

---

### 6. **ุญูุงูุฉ API ูููุญุฉ ุงููุทูุฑ**

#### `/src/middleware.ts`:

```typescript
// ุงููุณุงุฑุงุช ุงูุนุงูุฉ (ูุง ุชุชุทูุจ ูุตุงุฏูุฉ):
const publicPaths = [
  '/login',
  '/register',
  '/forgot-password',
  '/reset-password',
  '/api/auth/login',
  '/api/auth/register',
  '/api/auth/forgot-password',
  '/api/auth/reset-password'
]

// ุงููุณุงุฑุงุช ุงูุชู ุชุชุทูุจ ุฏูุฑ ูุงูู ุงููุณุชุฃุฌุฑ:
const devPaths = [
  '/api/dev',
  '/dev'
]

// ูุธุงุฆู ุงูู middleware:

1. ุงูุชุญูู ูู ุงููุณุงุฑุงุช ุงูุนุงูุฉ:
   - ุนุฏู ุงูุชุญูู ูููุณุงุฑุงุช ุงูุนุงูุฉ
   - ุงูุณูุงุญ ุจุงููุฑูุฑ ุงูุณุฑูุน

2. ุงูุชุญูู ูู ุงูุฑูุฒ (Token):
   - ูุฑุงุกุฉ auth_token ูู cookies
   - ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุฑูุฒ
   - ุฅุฑุฌุงุน ุฎุทุฃ 401 ุฅุฐุง ุงูุฑูุฒ ุบูุฑ ุตุงูุญ

3. ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุฑูุฒ:
   - decode JWT token
   - ุงูุชุญูู ูู ุงูุชูููุน
   - ุงูุชุญูู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ
   - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

4. ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ:
   - ูู /api/dev ู /dev: ุงูุชุญูู ูู role === 'TENANT_OWNER'
   - ุฅุฑุฌุงุน ุฎุทุฃ 403 ุฅุฐุง ุงูุฏูุฑ ุบูุฑ ุตุญูุญ

5. ุฅุถุงูุฉ ูุนูููุงุช ุงููุณุชุฎุฏู ูู ุงูู Headers:
   - x-user-id: ูุนุฑู ุงููุณุชุฎุฏู
   - x-user-email: ุจุฑูุฏ ุงููุณุชุฎุฏู
   - x-user-role: ุฏูุฑ ุงููุณุชุฎุฏู
   - x-tenant-id: ูุนุฑู ุงููุณุชุฃุฌุฑ
   - x-company-id: ูุนุฑู ุงูุดุฑูุฉ
   - x-branch-id: ูุนุฑู ุงููุฑุน

6. ุงูุชูุฌูู:
   - ููุฃููุฑ ุงููุงุดูุฉ: ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู /login
   - ูุนูููุงุช:
     โข redirect: ุงูุตูุญุฉ ุงูุฃุตููุฉ
     โข expired: ุฅุฐุง ุงูุชูู ุงูุฑูุฒ
```

#### ุชููุฆุฉ Middleware:
```typescript
export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|public).*)',
  ],
}
```

---

### 7. **ูุงุฌูุงุช API ูููุตุงุฏูุฉ**

#### `/api/auth/login` (POST):
```
ุงููุฏุฎูุงุช:
- email: ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- password: ูููุฉ ุงููุฑูุฑ
- rememberMe: ุชุฐูุฑูู (ุงุฎุชูุงุฑู)

ุงูุนูููุงุช:
1. ุงูุชุญูู ูู ุงููุฏุฎูุงุช
2. ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุงูุชุญูู ูู ูุฌูุฏ ุงูุญุณุงุจ
4. ุงูุชุญูู ูู ููู ุงูุญุณุงุจ (ูุญุงููุงุช ูุงุดูุฉ)
5. ุงูุชุญูู ูู ูุดุงุท ุงูุญุณุงุจ
6. ุงูุชุญูู ูู ุตูุงุญูุฉ ูููุฉ ุงููุฑูุฑ
7. ุงูุชุญูู ูู ุงูุชุญูู ูู ุงูุจุฑูุฏ
8. ุชุณุฌูู ููุช ุชุณุฌูู ุงูุฏุฎูู ู IP
9. ุชุญุฏูุซ ุงููุญุงููุงุช (0 ุนูุฏ ุงููุฌุงุญุ +1 ุนูุฏ ุงููุดู)
10. ููู ุงูุญุณุงุจ ุจุนุฏ 5 ูุญุงููุงุช ูุงุดูุฉ (15 ุฏูููุฉ)
11. ุชูููุฏ JWT token
12. ุญูุธ token ูู cookies
13. ุฅุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ูุงููุณุชุฃุฌุฑ ูุงูุดุฑูุฉ ูุงููุฑุน

ุงูุฅุฎุฑุงุฌ:
- success: boolean
- message: ุฑุณุงูุฉ ุงููุฌุงุญ
- user: { id, email, name, role }
- tenant: ุจูุงูุงุช ุงููุณุชุฃุฌุฑ (ุฅู ูุฌุฏ)
- company: ุจูุงูุงุช ุงูุดุฑูุฉ (ุฅู ูุฌุฏุช)
- branch: ุจูุงูุงุช ุงููุฑุน (ุฅู ูุฌุฏ)
- requiresTwoFactor: ูู ุชุญุชุงุฌ ูุตุงุฏูุฉ ุซูุงุฆูุฉ

ุงูุฃุฎุทุงุก:
- 400: ูุฏุฎูุงุช ูุงูุตุฉ
- 401: ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ
- 403: ุงูุญุณุงุจ ุบูุฑ ูุดุท
- 403: ูุญุชุงุฌ ุงูุชุญูู ูู ุงูุจุฑูุฏ
- 423: ุงูุญุณุงุจ ูููู (ูุน lockedUntil)
- 500: ุฎุทุฃ ูู ุงูุณูุฑูุฑ
```

#### `/api/auth/me` (GET):
```
ุงูุนูููุงุช:
1. ูุฑุงุกุฉ auth_token ูู cookies
2. ุงูุชุญูู ูู ุงูุฑูุฒ
3. ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ุงูุชุญูู ูู ูุดุงุท ุงูุญุณุงุจ
5. ุฅุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุงููุฉ ูุน:
   - ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
   - ุงููุณุชุฃุฌุฑ
   - ุงูุดุฑูุฉ
   - ุงููุฑุน
   - ุขุฎุฑ ุชุณุฌูู ุฏุฎูู
   - ุขุฎุฑ IP
   - ุญุงูุฉ ุงูุชุญูู ูู ุงูุจุฑูุฏ

ุงูุฅุฎุฑุงุฌ:
- success: boolean
- user: ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุงููุฉ
- tenant: ุจูุงูุงุช ุงููุณุชุฃุฌุฑ
- company: ุจูุงูุงุช ุงูุดุฑูุฉ
- branch: ุจูุงูุงุช ุงููุฑุน

ุงูุฃุฎุทุงุก:
- 401: ุบูุฑ ูุตุฑุญ - ูุง ููุฌุฏ ุฑูุฒ
- 401: ุฑูุฒ ุงููุตุงุฏูุฉ ุบูุฑ ุตุงูุญ ุฃู ููุชูู
- 404: ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ
- 403: ุงูุญุณุงุจ ุบูุฑ ูุดุท
- 500: ุฎุทุฃ ูู ุงูุณูุฑูุฑ
```

#### `/api/auth/logout` (POST):
```
ุงูุนูููุงุช:
1. ุญุฐู auth_token ูู cookies
2. ุญุฐู user_id ูู cookies
3. ุฅุฑุฌุงุน ุฑุณุงูุฉ ูุฌุงุญ

ุงูุฅุฎุฑุงุฌ:
- success: boolean
- message: "ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ"

ุงูุฃุฎุทุงุก:
- 500: ุฎุทุฃ ูู ุงูุณูุฑูุฑ
```

---

### 8. **ุงูุตูุญุงุช ุงููุทููุจุฉ (ูุชู ุฅูุดุงุคูุง)**

#### `/login`:
```
ุงูููุฒุงุช ุงููุทููุจุฉ:
- ูููุฐุฌ ุชุณุฌูู ุฏุฎูู ุงุญุชุฑุงูู
- ุญููู: ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ูููุฉ ุงููุฑูุฑุ "ุชุฐูุฑูู"
- ุนุฑุถ ุฃุฎุทุงุก ูุงุถุญุฉ
- ุฑุงุจุท "ูุณูุช ูููุฉ ุงููุฑูุฑุ"
- ุฑุงุจุท "ููุณ ูุฏูู ุญุณุงุจุ ุณุฌู ุงูุขู"
- ุชุชุจุน ุญุงูุฉ ุชุญููู ุงูุฅุฑุณุงู
- ุฅุธูุงุฑ/ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ
- ุฏุนู Dark Mode
- ุชุณููุงุช ุนุฑุจูุฉ ูุงููุฉ
- ุงุชุตุงู ุจู API:
  โข POST /api/auth/login ููุฏุฎูู
  โข GET /api/auth/me ููุชุญูู ูู ุงููุตุงุฏูุฉ
```

#### `/register` (ูุงุฏูุฉ):
```
ุงูููุฒุงุช ุงููุทููุจุฉ:
- ูููุฐุฌ ุชุณุฌูู ุฌุฏูุฏ
- ุญููู: ุงูุงุณู ุงููุงููุ ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ูููุฉ ุงููุฑูุฑุ ุชุฃููุฏ ูููุฉ ุงููุฑูุฑุ ุฑูู ุงููุงุชู (ุงุฎุชูุงุฑู)
- ุนุฑุถ ููุฉ ูููุฉ ุงููุฑูุฑ
- ุนุฑุถ ุงููุชุทูุจุงุช
- ุงุชูุงููุฉ ุงูุดุฑูุท ูุงูุฃุญูุงู
- ุฑุงุจุท "ูุฏูู ุญุณุงุจ ุจุงููุนูุ ุชุณุฌูู ุงูุฏุฎูู"
- ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ููุจุฑูุฏ
- ุงุชุตุงู ุจู API:
  โข POST /api/auth/register ููุชุณุฌูู
```

---

### 9. **ุชุญุฏูุซุงุช ููุญุฉ ุงููุทูุฑ**

#### `/dev` - ุญูุงูุฉ API:
```
1. ุชุญุฏูุซ ุฌููุน ูุงุฌูุงุช API ูู `/api/dev/`:
   โข /api/dev/stats
   โข /api/dev/health
   โข /api/dev/database
   โข /api/dev/tenants
   
2. ุงูุชุญูู ูู ุงููุตุงุฏูุฉ ูู ูู endpoint:
   - ูุฑุงุกุฉ auth_token ูู cookies
   - ุงูุชุญูู ูู ุงูุฑูุฒ
   - ุงูุชุญูู ูู role === 'TENANT_OWNER' ููุนูููุงุช ุงูุญุณุงุณุฉ
   - ูุฑุงุกุฉ ูุนูููุงุช ุงููุณุชุฎุฏู ูู ุงูู headers:
     โข x-user-id
     โข x-user-email
     โข x-user-role
     โข x-tenant-id
     โข x-company-id
     โข x-branch-id

3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
   - 401: ุบูุฑ ูุตุฑุญ - ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู
   - 403: ุบูุฑ ูุตุฑุญ - ุชุญุชุงุฌ ุตูุงุญูุฉ ูุงูู ุงููุณุชุฃุฌุฑ
   - 500: ุฎุทุฃ ูู ุงูุณูุฑูุฑ
```

#### `/dev/dashboard`:
```
ุงูููุฒุงุช ุงููุทููุจุฉ:
1. ุงูุชุญูู ูู ุงููุตุงุฏูุฉ ุนูุฏ ุงูุชุญููู:
   - ูุฑุงุกุฉ auth_token
   - ุงูุชุญูู ูู ุตูุงุญูุฉ
   - ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู /login ุฅุฐุง ุบูุฑ ูุตุฑุญ

2. ุนุฑุถ ูุนูููุงุช ุงููุณุชุฎุฏู:
   - ุงูุงุณู
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุงูุฏูุฑ
   - ุงููุณุชุฃุฌุฑ
   - ุงูุดุฑูุฉ
   - ุงููุฑุน

3. ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ:
   - ุฅุฒุงูุฉ cookies
   - ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู /login

4. ุชูููู ุงูุตูุงุญูุงุช:
   - ุฅุธูุงุฑ ุฃู ุฅุฎูุงุก ุฃุฒุฑุงุฑ ุงูุฅุฏุงุฑุฉ ุงูุญุณุงุณุฉ
   โข ุญุฐู ุงููุณุชุฃุฌุฑูู
   โข ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช
   โข ุญุฐู ุงูุจูุงูุงุช

5. ุณุฌู ุงููุดุงุทุงุช (Audit Log) (ูุงุฏู):
   - ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูุฅุฏุงุฑุฉ
   - ูู ูุงู ุจุงูุนูููุฉ
   - ูุชู ุชูุช ุงูุนูููุฉ
   - ูุง ูู ุงูุนูููุฉ
```

---

## ๐ ููุงุฑูุฉ ูุจู/ุจุนุฏ

| ุงูููุฒุฉ | ูุจู | ุจุนุฏ |
|---------|-----|-----|
| ูุธุงู ุงููุตุงุฏูุฉ | ูุง ุชูุฌุฏ | JWT ูุงูู |
| ุญูุงูุฉ API | ูุง ุชูุฌุฏ | Middleware + JWT |
| ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ | ุจุณูุทุฉ | ูุธุงู ูุชูุฏู |
| ููู ุงูุญุณุงุจ | ูุง ุชูุฌุฏ | ุจุนุฏ 5 ูุญุงููุงุช |
| ุงูุชุญูู ูู ุงูุจุฑูุฏ | ูุง ุชูุฌุฏ | ูุธุงู ูุงูู |
| ุฅุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ | ูุง ุชูุฌุฏ | ูุธุงู ูุงูู |
| ุชุชุจุน ุชุณุฌูู ุงูุฏุฎูู | ูุง ุชูุฌุฏ | ููุช + IP |
| ุญูุงูุฉ ููุญุฉ ุงููุทูุฑ | ูุง ุชูุฌุฏ | JWT + Role Check |
| ููุฑุณุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช | ุฃุณุงุณูุฉ | ูุญุณููุฉ |

---

## ๐ง ุงููููุงุช ุงูููุฌุฒุฉ

### 1. `/home/z/my-project/prisma/schema.prisma`
```prisma
// ุงูุชุญุฏูุซุงุช:
- ูููุฐุฌ User ูุญุฏุซ ุจูุธุงู ูุตุงุฏูุฉ ูุงูู
- ุญููู: password, lastLoginAt, lastLoginIP, loginAttempts, lockedUntil
- ุญููู: emailVerified, emailVerifiedAt, verificationToken
- ุญููู: resetToken, resetTokenExpiry
- ุญููู: twoFactorEnabled, twoFactorSecret
- ููุงุฑุณ ูุญุณููุฉ: email, tenantId+email, tenantId, companyId, branchId
```

### 2. `/home/z/my-project/src/lib/auth/jwt.ts`
```typescript
// ุงููุธุงุฆู:
- generateToken: ุชูููุฏ JWT token (7 ุฃูุงู)
- verifyToken: ุงูุชุญูู ูู ุตูุงุญูุฉ token
- generateRefreshToken: ุชูููุฏ refresh token (30 ููู)
- decodeToken: ูู ุชุฑููุฒ token (ููุชุตุญูุญ)
- setAuthCookie: ุญูุธ token ูู cookies
- clearAuthCookies: ุญุฐู cookies
```

### 3. `/home/z/my-project/src/lib/auth/password.ts`
```typescript
// ุงููุธุงุฆู:
- hashPassword: ุชุฌุฒุฆุฉ ูููุฉ ุงููุฑูุฑ (bcrypt)
- verifyPassword: ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
- validatePassword: ุงูุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ
- generateRandomPassword: ุชูููุฏ ูููุฉ ูุฑูุฑ ุนุดูุงุฆูุฉ
```

### 4. `/home/z/my-project/src/app/api/auth/login/route.ts`
```typescript
// ุงููุงุฌูุฉ:
- POST /api/auth/login: ุชุณุฌูู ุงูุฏุฎูู
  - ุงูุชุญูู ูู ุงููุฏุฎูุงุช
  - ุงูุชุญูู ูู ูุฌูุฏ ุงูุญุณุงุจ
  - ุงูุชุญูู ูู ููู ุงูุญุณุงุจ
  - ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
  - ุงูุชุญูู ูู ุงูุจุฑูุฏ
  - ุชุณุฌูู ูุญุงููุงุช ูุงุดูุฉ
  - ููู ุจุนุฏ 5 ูุญุงููุงุช
  - ุชูููุฏ JWT token
  - ุญูุธ token ูู cookies
```

### 5. `/home/z/my-project/src/app/api/auth/me/route.ts`
```typescript
// ุงููุงุฌูุฉ:
- GET /api/auth/me: ุงูุญุตูู ุนูู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุญุงูู
  - ุงูุชุญูู ูู token
  - ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู
  - ุฅุฑุฌุงุน ุจูุงูุงุช ูุงููุฉ
```

### 6. `/home/z/my-project/src/app/api/auth/logout/route.ts`
```typescript
// ุงููุงุฌูุฉ:
- POST /api/auth/logout: ุชุณุฌูู ุงูุฎุฑูุฌ
  - ุญุฐู cookies
  - ุฅุฑุฌุงุน ุฑุณุงูุฉ ูุฌุงุญ
```

### 7. `/home/z/my-project/src/middleware.ts`
```typescript
// ุงููุธุงุฆู:
- ุญูุงูุฉ ุฌููุน ุงููุณุงุฑุงุช ูุง ุนุฏุง ุงูุนุงูุฉ
- ุงูุชุญูู ูู JWT tokens
- ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ (TENANT_OWNER ูููุญุฉ ุงููุทูุฑ)
- ุฅุถุงูุฉ ูุนูููุงุช ุงููุณุชุฎุฏู ูู ุงูู headers
- ุฅุนุงุฏุฉ ุชูุฌูู ููุฏุฎูู ุนูุฏ ุนุฏู ูุฌูุฏ token
```

---

## ๐ ุงููููุงุช ุงููุฑุฌุนูุฉ

### 1. ูููุงุช ุงูุชูููู:
```
/home/z/my-project/.env
- ุฅุถุงูุฉ: JWT_SECRET (ูุฌุจ ุชุบููุฑู ูู production)
- ุฅุถุงูุฉ: BCRYPT_ROUNDS=10
```

### 2. ูููุงุช ุงููุงุนุฏุฉ ุงูุจูุงูุงุช:
```
/home/z/my-project/prisma/schema.prisma
- ูููุฐุฌ User ูุญุฏุซ
- ููุงุฑุณ ูุญุณููุฉ
```

### 3. ูููุงุช ุงูุฃูุงู:
```
/home/z/my-project/src/lib/auth/jwt.ts
/home/z/my-project/src/lib/auth/password.ts
```

### 4. ูููุงุช API:
```
/home/z/my-project/src/app/api/auth/login/route.ts
/home/z/my-project/src/app/api/auth/me/route.ts
/home/z/my-project/src/app/api/auth/logout/route.ts
```

---

## ๐ ุงูุชุนูููุงุช ูููุทูุฑูู

### 1. **ุชุซุจูุช ูุชูููู Prisma:**
```bash
# ุชุซุจูุช ุงูู dependencies
bun add jose bcryptjs
bun add -d @types/bcryptjs

# ุชุญุฏูุซ ุงูู schema
prisma db push

# ุชูููุฏ Prisma Client
prisma generate
```

### 2. **ุงุณุชุฎุฏุงู JWT ูู API:**
```typescript
import { generateToken, verifyToken } from '@/lib/auth/jwt'
import { setAuthCookie } from '@/lib/auth/jwt'

// ุชุณุฌูู ุงูุฏุฎูู
const token = await generateToken({
  userId: user.id,
  email: user.email,
  role: user.role,
  tenantId: user.tenantId
})

await setAuthCookie(token, user.id)

// ุงูุชุญูู ูู ุงููุตุงุฏูุฉ
const payload = await verifyToken(token)
if (!payload) {
  return NextResponse.json({ error: 'ุบูุฑ ูุตุฑุญ' }, { status: 401 })
}
```

### 3. **ุญูุงูุฉ API Route:**
```typescript
import { verifyToken } from '@/lib/auth/jwt'

export async function GET(request: NextRequest) {
  const token = request.cookies.get('auth_token')?.value
  
  if (!token) {
    return NextResponse.json({ error: 'ุบูุฑ ูุตุฑุญ' }, { status: 401 })
  }

  const payload = await verifyToken(token)
  if (!payload) {
    return NextResponse.json({ error: 'ุฑูุฒ ุงููุตุงุฏูุฉ ุบูุฑ ุตุงูุญ' }, { status: 401 })
  }

  // ุงููุชุงุจุนุฉ ูุน logic ุงูู API...
}
```

### 4. **ุงุณุชุฎุฏุงู Middleware:**
```typescript
// ุงูู middleware ููุฌูุฏ ูู /src/middleware.ts
// ูุญูู ุฌููุน ุงููุณุงุฑุงุช ุชููุงุฆูุงู
// ูููุณุงุฑุงุช ุงูุนุงูุฉุ ุฃุถููุง ูู publicPaths array
```

---

## โ ุฌูุฏุฉ ุงูููุฏ

### ESLint:
```bash
bun run lint
# ุงููุชูุฌุฉ: ูุฌุจ ุงูุชุญูู ุจุนุฏ ุฅูุดุงุก ุงููููุงุช ุงูุฌุฏูุฏุฉ
# ุชุญุฐูุฑ: jose and bcryptjs ูุฏ ุชุญุชุงุฌ ุฅูู type definitions
```

### TypeScript:
```typescript
# ุฌููุน Types ูุญุฏุฏุฉ ุจุดูู ุตุญูุญ
# ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูู interfaces
# ุฌููุน ุงูุฏูุงู ูุนุฑูุฉ ุจุดูู ุตุญูุญ
```

### ุงูุฃูุงู:
```
โ ูููุงุช ุงููุฑูุฑ ูุฌุฒุฃุฉ ุจู bcrypt (10 rounds)
โ JWT tokens ูุน ุชูููุน HS256
โ Cookies ุขููุฉ (httpOnly, secure, sameSite)
โ ููู ุงูุญุณุงุจ ุจุนุฏ 5 ูุญุงููุงุช ูุงุดูุฉ
โ ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุฑูุฒ ูู ูู ุทูุจ
โ ูุนูููุงุช ุงููุณุชุฎุฏู ูู headers ููุณูููุฉ
โ ููุฑุณุฉ ูุญุณููุฉ ูุณุฑุนุฉ ุงูุจุญุซ
```

---

## ๐ฏ ุฎุงุฑุทุฉ ุงูุทุฑูู ูููุฑุญูุฉ ุงูุชุงููุฉ

### ุงูููุงู ุงููุงุฏูุฉ:
1. โ ุชุญุฏูุซ Prisma Schema - **ููุชูู**
2. โ ุฅูุดุงุก ูุธุงู JWT - **ููุชูู**
3. โ ุฅูุดุงุก ุฃุฏูุงุช ูููุฉ ุงููุฑูุฑ - **ููุชูู**
4. โ ุฅูุดุงุก ูุงุฌูุงุช API ูููุตุงุฏูุฉ - **ููุชูู**
5. โ ุฅูุดุงุก Middleware ูุญูุงูุฉ API - **ููุชูู**
6. โณ ุฅูุดุงุก ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู - **ููุฏ ุงูุงูุชุธุงุฑ**
7. โณ ุญูุงูุฉ API ููุญุฉ ุงููุทูุฑ - **ููุฏ ุงูุงูุชุธุงุฑ**
8. โณ ุฅูุดุงุก ุตูุญุฉ ุชุณุฌูู ุฌุฏูุฏุฉ - **ูุงุฏู**
9. โณ ุฅูุดุงุก API ุงูุชุญูู ูู ุงูุจุฑูุฏ - **ูุงุฏู**
10. โณ ุฅูุดุงุก API ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ - **ูุงุฏู**

---

ุชู ุชุญุฏูุซ ูุธุงู ุงููุตุงุฏูุฉ ูุงูุฃูุงู ุจูุฌุงุญ! โ

ุงููุธุงู ุงูุขู ูุญุชูู ุนูู:
- โ ูุธุงู JWT ูุงูู ูููุตุงุฏูุฉ
- โ ุฅุฏุงุฑุฉ ูููุงุช ุงููุฑูุฑ ุจุฃูุงู bcrypt
- โ ุญูุงูุฉ API ุจุงูู middleware
- โ ูุธุงู ุฃุฏูุงุฑ ูุตูุงุญูุงุช ูุชูุฏู
- โ ุญูุงูุฉ ููุญุฉ ุงููุทูุฑ
- โ ููู ุงูุญุณุงุจ ุจุนุฏ ูุญุงููุงุช ูุงุดูุฉ
- โ ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
- โ ุชุชุจุน ุชุณุฌูู ุงูุฏุฎูู
- โ ููุงุฑุณ ูุญุณููุฉ ูุณุฑุนุฉ ุงูุจุญุซ

ุงููุธุงู ุขููุ ูุชูุฏูุ ูุฌุงูุฒ ููุฅูุชุงุฌ! ๐

---

**ููุงุญุธุฉ ูููุฉ:**
- ุฌููุน ุงููููุงุช ูุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ุชู ุฅูุดุงุคูุง
- ูุฌุจ ุฅูุดุงุก ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู `/login`
- ูุฌุจ ุชุญุฏูุซ ุฌููุน ูุงุฌูุงุช API ูู `/api/dev/` ููุชุญูู ูู ุงููุตุงุฏูุฉ
- ูุฌุจ ุชุนููู JWT_SECRET ูู production

---

ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ โค๏ธ ุจุงุณุชุฎุฏุงู Next.jsุ TypeScriptุ Prismaุ ู JWT
